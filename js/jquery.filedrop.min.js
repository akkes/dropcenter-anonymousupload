(function(a){function x(){}function w(a){e=setTimeout(function(){b.docLeave(a)},200)}function v(a){clearTimeout(e);a.preventDefault();b.docOver(a);return false}function u(a){clearTimeout(e);a.preventDefault();b.docEnter(a);return false}function t(a){a.preventDefault();b.docLeave(a);return false}function s(a){clearTimeout(e);b.dragLeave(a);a.stopPropagation()}function r(a){clearTimeout(e);a.preventDefault();b.docOver(a);b.dragOver(a)}function q(a){clearTimeout(e);a.preventDefault();b.dragEnter(a)}function p(){return b.afterAll()}function o(a){return b.beforeEach(a)}function n(a){return b.rename(a)}function m(a){for(var b=0;b<g;b++){if(h[b].size==a){return b}}return undefined}function l(){function r(d){if(d.target.index==undefined){d.target.index=m(d.total)}var e=new XMLHttpRequest,i=e.upload,l=h[d.target.index],o=d.target.index,q=(new Date).getTime(),r="------multipartformboundary"+(new Date).getTime(),s;newName=n(l.name);if(typeof newName==="string"){s=j(newName,d.target.result,r)}else{s=j(l.name,d.target.result,r)}i.index=o;i.file=l;i.downloadStartTime=q;i.currentStart=q;i.currentProgress=0;i.startData=0;i.addEventListener("progress",k,false);e.open("POST",b.url,true);e.setRequestHeader("content-type","multipart/form-data; boundary="+r);e.sendAsBinary(s);b.uploadStarted(o,l,g);e.onload=function(){if(e.responseText){var d=(new Date).getTime(),h=d-q,i=b.uploadFinished(o,l,jQuery.parseJSON(e.responseText),h);a++;if(a==g-c){p()}if(i===false)f=true}}}f=false;if(!h){b.error(d[0]);return false}var a=0,c=0;if(g>b.maxfiles){b.error(d[1]);return false}for(var e=0;e<g;e++){if(f)return false;try{if(o(h[e])!=false){if(e===g)return;var i=new FileReader,l=1048576*b.maxfilesize;i.index=e;if(h[e].size>l){b.error(d[2],h[e],e);c++;continue}i.onloadend=r;i.readAsBinaryString(h[e])}else{c++}}catch(q){b.error(d[0]);return false}}}function k(a){if(a.lengthComputable){var c=Math.round(a.loaded*100/a.total);if(this.currentProgress!=c){this.currentProgress=c;b.progressUpdated(this.index,this.file,this.currentProgress);var d=(new Date).getTime();var e=d-this.currentStart;if(e>=b.refresh){var f=a.loaded-this.startData;var g=f/e;b.speedUpdated(this.index,this.file,g);this.startData=a.loaded;this.currentStart=d}}}}function j(c,d,e){var f="--",g="\r\n",h="";a.each(b.data,function(a,b){if(typeof b==="function")b=b();h+=f;h+=e;h+=g;h+='Content-Disposition: form-data; name="'+a+'"';h+=g;h+=g;h+=b;h+=g});h+=f;h+=e;h+=g;h+='Content-Disposition: form-data; name="'+b.paramname+'"';h+='; filename="'+c+'"';h+=g;h+="Content-Type: application/octet-stream";h+=g;h+=g;h+=d;h+=g;h+=f;h+=e;h+=f;h+=g;return h}function i(a){b.drop(a);h=a.dataTransfer.files;if(h===null||h===undefined){b.error(d[0]);return false}g=h.length;l();a.preventDefault();return false}jQuery.event.props.push("dataTransfer");var b={},c={url:"",refresh:1e3,paramname:"userfile",maxfiles:25,maxfilesize:1,data:{},drop:x,dragEnter:x,dragOver:x,dragLeave:x,docEnter:x,docOver:x,docLeave:x,beforeEach:x,afterAll:x,rename:x,error:function(a,b,c){alert(a)},uploadStarted:x,uploadFinished:x,progressUpdated:x,speedUpdated:x},d=["BrowserNotSupported","TooManyFiles","FileTooLarge"],e,f=false,g=0,h;a.fn.filedrop=function(d){b=a.extend({},c,d);this.bind("drop",i).bind("dragenter",q).bind("dragover",r).bind("dragleave",s);a(document).bind("drop",t).bind("dragenter",u).bind("dragover",v).bind("dragleave",w)};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(a){function b(a){return a.charCodeAt(0)&255}var c=Array.prototype.map.call(a,b);var d=new Uint8Array(c);this.send(d.buffer)}}catch(y){}})(jQuery)